# ANY-GO WebApp 项目规格说明书

## 1. 项目概述
基于Django的ERP系统，主要用于管理产品、发货单和装箱单等信息。无需登录即可使用所有功能，操作更加便捷。

## 2. 核心功能

### 2.1 产品管理
- SKU管理
- 产品信息维护
- 批量导入导出
- 自动创建缺失SKU

### 2.3 发货单管理
成本和货值字段都只保留两位小数
- 发货单导入功能
  - 导入时设置发货单状态为"在途"
  - 支持Excel文件导入，包含SKU、数量、采购成本、体积等信息
  - 自动将产品价格设置为采购成本
  - 支持多家店铺选择（1号店, 2号店, 8号店, 9号店, 12号店, 13号店, 16号店, 20号店）
- 发货单列表显示
- 变更状态功能
  - 将发货单状态从"在途"变更为"到岸"
  - 填写头程总价格并自动按体积比例分摊头程成本
  货值=（采购成本+头程成本）*数量
  - 更新产品的头程成本信息
- 回退态功能
  将发货单状态从"到岸"回退为"在途" 
  回退成当初在途的状态
  删去头程成本字段，删去总价格，货值=采购成本*数量
- 删除功能

### 2.4 数据管理
- 清除所有数据功能（便于测试和重置系统）

## 3. 数据规则

### 3.2 发货单Excel格式
- 导入文件必须包含以下列：
  - SKU：产品编号
  - 数量：导入数量
  - 采购成本：产品采购价格
  - 体积：产品体积
  - 中文名称（可选）：产品名称

### 3.5 头程成本计算规则
- 计算方式：按体积比例分摊
- 计算过程：
  1. 计算发货单中所有物品的总体积
  2. 计算每个物品占总体积的比例
  3. 按比例分摊总价格得到每个物品的总头程成本
  4. 除以物品数量得到单个物品的头程成本（保留两位小数，处理0数量情况）
  5. 更新产品的头程成本字段

### 3.6 数值精度规则
- 所有金额和价格字段保留两位小数
- 采用四舍五入进位规则
- 处理物品数量为0的边缘情况，防止除零错误

## 4. 用户界面规范
- 响应式设计
- 支持大屏显示
- 表格布局使用grid布局
- 弹窗使用WeUI风格

## 5. 已实现功能
- 产品管理（增删改查、批量导入导出）
- 发货单管理（导入、列表、详情、变更状态、删除）
- 店铺管理（支持多家店铺）
- 头程成本自动计算与分摊
- 清除所有数据功能
- 价格精度控制（两位小数）

## 6. 近期优化
- 移除登录功能，简化使用流程
- 修复头程成本计算中的除零错误
- 统一价格字段精度为两位小数
- 添加一键清除数据功能方便测试

## 7. 技术规范
- Python 3.9+
- Django 4.2+
- 代码格式遵循PEP8
- 使用绝对导入
- 视图函数添加类型注解